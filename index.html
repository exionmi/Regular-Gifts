<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Regular Gifts</title>
    
    <!-- Условное подключение тестового режима -->
    <script>
        // Проверяем условия для тестового режима
        const enableTestMode = 
            // Если есть параметр test=true в URL
            new URLSearchParams(window.location.search).get('test') === 'true' || 
            // Если мы на локальном хосте и нет Telegram в window
            ((window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') && 
             typeof window.Telegram === 'undefined');
        
        // Динамически добавляем скрипт тестового режима, если нужно
        if (enableTestMode) {
            document.write('<script src="test-mode.js"><\/script>');
            console.log("Тестовый режим активирован");
        }
    </script>
    
    <!-- Скрипт Telegram WebApp -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- Стили приложения -->
    <link rel="stylesheet" href="styles.css?v=3">
</head>
<body>
    <div class="app-container">
        <!-- Навигационное меню -->
        <div class="nav-tabs">
            <button class="tab-btn active" data-tab="wheel">Колесо</button>
            <button class="tab-btn" data-tab="profile">Профиль</button>
        </div>

        <!-- Страница с колесом -->
        <div class="tab-content active" id="wheel-tab">
            <div class="wheel-container">
                <div class="wheel" id="fortune-wheel">
                    <!-- Секции колеса будут добавлены через JavaScript -->
                </div>
                <div class="wheel-pointer"></div>
                <button id="spin-btn" class="spin-button">Крутить колесо</button>
            </div>
            <div class="result-container" id="result-container" style="display:none;">
                <h2>Ваш выигрыш:</h2>
                <div id="prize-display">
                    <img id="prize-image" src="#" alt="Приз">
                    <p id="prize-name"></p>
                    <p id="prize-value">+<span id="stars-value">0</span> звезд</p>
                </div>
                <button id="continue-btn">Продолжить</button>
            </div>
        </div>
        <!-- Страница профиля -->
        <div class="tab-content" id="profile-tab">
            <div class="profile-container">
                <div class="profile-header">
                    <div class="avatar-container">
                        <img id="user-avatar" src="images/default-avatar.png" alt="Аватар">
                    </div>
                    <div class="user-info">
                        <h2 id="user-name">Загрузка...</h2>
                        <!-- Добавляем элемент для отображения username -->
                        <p id="user-username" class="username-text"></p>
                        <div class="balance">
                            <img src="images/star.png" alt="Звезда" class="star-icon">
                            <span id="user-stars">0</span> звезд
                        </div>
                    </div>
                </div>
                <div class="prizes-history">
                    <h3>История выигрышей</h3>
                    <ul id="prizes-list">
                        <!-- История выигрышей будет добавлена через JavaScript -->
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <!-- Подключаем скрипты -->
    <script src="wheel.js?v=3"></script>
    <script src="app.js?v=3"></script>
    
    <!-- Отладочные скрипты (добавляются только в режиме разработки) -->
    <script>
        // Проверяем, в режиме ли разработки
        if (enableTestMode || window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            const debugScript = document.createElement('script');
            debugScript.src = 'telegram_debug.js';
            document.body.appendChild(debugScript);
            console.log("Режим отладки активирован");
        }
    </script>
</body>
</html>

